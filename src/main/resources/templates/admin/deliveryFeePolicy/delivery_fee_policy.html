<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š ì±…ì‚¬ì¡°ì‰ ê´€ë¦¬ì í˜ì´ì§€ ğŸ“š</title>
    <style>
        /* ê³µí†µ ìŠ¤íƒ€ì¼ */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; /* ì „ì²´ ë†’ì´ë¥¼ 100%ë¡œ ì„¤ì • */
            font-family: 'Arial', sans-serif;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header {
            background-color: #333;
            padding: 15px 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header .logo {
            text-decoration: none;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        header .menu a,
        header .icons a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-size: 16px;
        }

        header .menu a:hover,
        header .icons a:hover {
            color: #f1f1f1;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        main {
            flex: 1; /* ë‚¨ì€ ê³µê°„ì„ ì±„ìš°ë„ë¡ ì„¤ì • */
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar {
            width: 220px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .sidebar .group {
            display: block;
            text-decoration: none;
            color: inherit;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 16px;
            text-align: center;
            transition: background-color 0.3s;
        }

        .sidebar .group.active,
        .sidebar .group:hover {
            background-color: #ddd;
            color: black;
        }

        /* ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
        .content {
            flex: 1;
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .content h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-wrapper {
            margin-top: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #333;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:nth-child(odd) {
            background-color: #fff;
        }

        /* ì…ë ¥ í•„ë“œ ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        td input, td select {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background-color: #333;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #555;
        }

        /* ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .view-buttons, .edit-buttons {
            display: flex;
            gap: 10px;
        }

        .view-buttons button, .edit-buttons button {
            width: auto;
            padding: 5px 10px;
            font-size: 14px;
            border-radius: 4px;
        }

        /* í‘¸í„° ìŠ¤íƒ€ì¼ */
        footer {
            background-color: #333;
            color: white;
            padding: 15px 20px;
            text-align: center;
            margin-top: auto; /* í‘¸í„°ë¥¼ í™”ë©´ í•˜ë‹¨ìœ¼ë¡œ ë°€ê¸° */
        }

        footer a {
            color: #00aaff;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }


    </style>
</head>
<body>
<header>
    <a href="/" class = "logo">ğŸ“š ì±…ì‚¬ì¡°ì‰ ğŸ“š</a>
    <nav class="menu">
        <a href="/">í™ˆ</a>
        <a href="#">êµ­ë‚´ë„ì„œ</a>
        <a href="#">ì™¸êµ­ë„ì„œ</a>
        <a href="#">ì¶”ì²œë„ì„œ</a>
    </nav>
    <div class="icons">
        <a href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</header>

<main>
    <!-- ì‚¬ì´ë“œë°” -->
    <th:block th:replace="~{admin/sidebar.html}"></th:block>
<h2>ë°°ì†¡ë¹„ì •ì±… ê´€ë¦¬</h2>
<table>
    <thead>
    <tr>
        <th>ë²ˆí˜¸</th>
        <th>ì •ì±…ì´ë¦„</th>
        <th>ê¸°ë³¸ë°°ì†¡ë¹„</th>
        <th>ë¬´ë£Œë°°ì†¡ ê¸°ì¤€ê¸ˆì•¡</th>
        <th>ê´€ë¦¬</th>
    </tr>
    </thead>
    <tr>
        <td></td>
        <td>
            <input type="text" id="name" placeholder="ì •ì±…ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">
        </td>
        <td>
            <input type="number" id="defaultDeliveryFee" placeholder="ê¸°ë³¸ë°°ì†¡ë¹„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
        </td>
        <td>
            <input type="number" id="freeDeliveryThreshold" placeholder="ë¬´ë£Œë°°ì†¡ ê¸°ì¤€ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">
        </td>
        <td>
            <button type="button" id="saveBtn" onclick="registerPolicy()">ë“±ë¡</button>
        </td>
    </tr>
    <tr th:each="policy: ${policies}" th:id="'policy-row-' + ${policy.getId()}" >
        <td>
            <span th:text="${policy.getId()}"></span>
        </td>
        <td>
            <span th:text="${policy.getName()}"></span>
            <input type="text" style="display: none;" th:value="${policy.getName()}" />
        </td>
        <td>
            <span th:text="${policy.getDefaultDeliveryFee()}"></span>
            <input type="number" style="display: none;" th:value="${policy.getDefaultDeliveryFee()}" />
        </td>
        <td>
            <span th:text="${policy.getFreeDeliveryThreshold()}"></span>
            <input type="number" style="display: none;" th:value="${policy.getFreeDeliveryThreshold()}" />
        </td>
        <td>
            <div class="view-buttons">
                <button type="button" th:onclick="editPolicy([[${policy.getId()}]])">ìˆ˜ì •</button>
                <button type="button" th:onclick="removePolicy([[${policy.getId()}]])">ì‚­ì œ</button>
            </div>
            <div class="edit-buttons" style="display: none;">
                <button type="button" th:onclick="updatePolicy([[${policy.getId()}]])">ì €ì¥</button>
                <button type="button" th:onclick="cancelEdit([[${policy.getId()}]])">ì·¨ì†Œ</button>
            </div>
        </td>
    </tr>
</table>
</main>
<script>
    // ì •ì±… ë“±ë¡
    async function registerPolicy() {
        const name = document.getElementById('name').value;
        const defaultDeliveryFee = document.getElementById('defaultDeliveryFee').value;
        const freeDeliveryThreshold = document.getElementById('freeDeliveryThreshold').value;
        const data = {
            name: name,
            defaultDeliveryFee: defaultDeliveryFee,
            freeDeliveryThreshold: freeDeliveryThreshold
        }

        const response = await fetch('/api/delivery-fee-policies', {
            method: 'POST',
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })

        if (!response.ok) {
            alert('ë°°ì†¡ë¹„ì •ì±… ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            return;
        }

        alert('ë°°ì†¡ë¹„ì •ì±…ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        window.location.reload();
    }

    // ì •ì±… ì‚­ì œ
    async function removePolicy(id) {
        const response = await fetch(`/api/delivery-fee-policies/${id}`, {
            method: 'DELETE'
        })

        if (!response.ok) {
            alert('ë°°ì†¡ë¹„ì •ì±… ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            return;
        }

        alert('ë°°ì†¡ë¹„ì •ì±…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        window.location.reload();
    }

    // ìˆ˜ì • ëª¨ë“œ í™œì„±í™”
    function editPolicy(id) {
        const row = document.getElementById(`policy-row-${id}`);
        const spans = row.querySelectorAll('span');
        const inputs = row.querySelectorAll('input');
        const viewButtons = row.querySelector('.view-buttons');
        const editButtons = row.querySelector('.edit-buttons');

        // spanì„ ìˆ¨ê¸°ê³  inputì„ ë³´ì—¬ì¤Œ
        spans.forEach((span, index) => {
            if (index === 0) return; // IDëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŒ
            span.style.display = 'none';
            inputs[index - 1].style.display = ''; // index-1 because we skip the first span (ID)
        });

        // ë²„íŠ¼ ë³€ê²½
        viewButtons.style.display = 'none';
        editButtons.style.display = '';
    }

    // ìˆ˜ì • ì·¨ì†Œ
    function cancelEdit(id) {
        const row = document.getElementById(`policy-row-${id}`);
        const spans = row.querySelectorAll('span');
        const inputs = row.querySelectorAll('input');
        const viewButtons = row.querySelector('.view-buttons');
        const editButtons = row.querySelector('.edit-buttons');

        // inputì„ ìˆ¨ê¸°ê³  spanì„ ë³´ì—¬ì¤Œ
        spans.forEach((span, index) => {
            if (index === 0) return; // IDëŠ” ê±´ë„ˆëœ€
            span.style.display = '';
            inputs[index - 1].style.display = 'none';
        });

        // ë²„íŠ¼ ë³€ê²½
        viewButtons.style.display = '';
        editButtons.style.display = 'none';
    }

    // ì •ì±… ì €ì¥
    async function updatePolicy(id) {
        const row = document.getElementById(`policy-row-${id}`);
        const inputs = row.querySelectorAll('input');
        const data = {
            name: inputs[0].value,
            defaultDeliveryFee: inputs[1].value,
            freeDeliveryThreshold: inputs[2].value
        };

        const response = await fetch(`/api/delivery-fee-policies/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        if (!response.ok) {
            alert('ì •ì±… ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            return;
        }

        alert('ì •ì±…ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        window.location.reload();
    }
    const currentPath = window.location.pathname;
    const sidebarLinks = document.querySelectorAll('.sidebar .group');

    sidebarLinks.forEach(link => {
        const linkPath = link.getAttribute('href');
        if (linkPath === currentPath) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }

        link.addEventListener('click', () => {
            sidebarLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
        });
    });
</script>
<th:block th:replace="~{layout/layout :: footerLayout}"></th:block>
</body>
</html>