<header th:fragment="headerContent(isLoggedIn)">
    <div class="logo">๐ ์ฑ์ฌ์กฐ์ ๐</div>
    <nav class="menu">
        <a href="/">Home</a>
        <a href="#">๊ตญ๋ด๋์</a>
        <a href="#">์ธ๊ตญ๋์</a>
        <a href="#">์ถ์ฒ๋์</a>
    </nav>
    <div class="icons">
        <!-- ๋ก๊ทธ์ธ ์ํ์ ๋ฐ๋ผ ๋ฒํผ ํ์ -->
        <a th:if="${isLoggedIn}" href="/mypage" id="mypage-btn">MyPage</a>
        <a th:if="${isLoggedIn}" href="/logout" id="logout-btn" onclick="logout()">๋ก๊ทธ์์</a>
        <a th:if="${!isLoggedIn}" href="/login" id="login-btn">๋ก๊ทธ์ธ</a>
        <a th:if="${!isLoggedIn}" href="/signup" id="signup-btn">ํ์๊ฐ์</a>
    </div>
</header>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        updateLoginStatus();

        // ๋ก๊ทธ์์ ๋ฒํผ ์ด๋ฒคํธ ๋ฆฌ์ค๋ ๋ฐ์ธ๋ฉ
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                fetch('/logout', {
                    method: 'POST',
                    credentials: 'same-origin',
                })
                    .then(response => {
                        if (response.ok) {
                            updateLoginStatus();
                            window.location.href = '/login';
                        } else {
                            console.error('๋ก๊ทธ์์ ์คํจ');
                        }
                    })
                    .catch(error => {
                        console.error('๋ก๊ทธ์์ ์์ฒญ ์ค ์๋ฌ ๋ฐ์:', error);
                    });
            });
        }
    });

    function updateLoginStatus() {
        fetch('/api/check-login', {
            method: 'GET',
            credentials: 'same-origin'
        })
            .then(response => response.json())
            .then(isLoggedIn => {
                const loginBtn = document.getElementById('login-btn');
                const signupBtn = document.getElementById('signup-btn');
                const mypageBtn = document.getElementById('mypage-btn');
                const logoutBtn = document.getElementById('logout-btn');

                if (isLoggedIn) {
                    if (loginBtn) loginBtn.style.display = 'none';
                    if (signupBtn) signupBtn.style.display = 'none';
                    if (mypageBtn) mypageBtn.style.display = 'inline-block';
                    if (logoutBtn) logoutBtn.style.display = 'inline-block';
                } else {
                    if (loginBtn) loginBtn.style.display = 'inline-block';
                    if (signupBtn) signupBtn.style.display = 'inline-block';
                    if (mypageBtn) mypageBtn.style.display = 'none';
                    if (logoutBtn) logoutBtn.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('๋ก๊ทธ์ธ ์ํ ํ์ธ ์ค ์๋ฌ ๋ฐ์:', error);
            });
    }

    function logout() {
        fetch('/logout', {
            method: 'POST',
            credentials: 'same-origin',
        })
            .then(response => {
                if (response.ok) {
                    window.location.href = '/login';
                } else {
                    console.error('๋ก๊ทธ์์ ์คํจ');
                }
            })
            .catch(error => {
                console.error('๋ก๊ทธ์์ ์์ฒญ ์ค ์๋ฌ ๋ฐ์:', error);
            });
    }
</script>
