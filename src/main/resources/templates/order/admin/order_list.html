<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문 목록 조회</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/css/order/allOrderList.css">
    <link rel="stylesheet" href="/css/layout/layout.css">
</head>
<body>
<header>
    <a href="/" class = "logo">📚 책사조잉 📚</a>
    <nav class="menu">
        <a href="/">홈</a>
        <a href="#">국내도서</a>
        <a href="#">외국도서</a>
        <a href="#">추천도서</a>
    </nav>
    <div class="icons">
        <a href="/logout">로그아웃</a>
    </div>
</header>

<main>
    <!-- 사이드바 -->
    <div class="sidebar">
        <a href="/admin/members" class="group">회원 관리</a>
        <a href="/admin/books" class="group">도서 관리</a>
        <a href="/admin/selling-books" class="group">판매 도서 관리</a>
        <a href="/admin/tags" class="group">태그 관리</a>
        <a href="/admin/points-conditions" class="group">포인트 조건 관리</a>
        <a href="/admin/category" class="group">카테고리 관리</a>
        <a href="/admin/coupon-register" class="group">쿠폰 제작</a>
        <a href="/admin/coupon-issue" class="group">쿠폰 발급</a>
        <a href="/admin/wrapping-papers" class="group">포장지 관리</a>
        <a href="/admin/delivery-fee-policies" class="group">배송비정책 관리</a>
        <a href="/admin/orders" class="group">주문 관리</a>
        <a href="/admin/order-product-returns" class="group">반품요청 관리</a>
        <a href = "/admin/authors" class="group" data-section="author-management">작가 관리</a>

    </div>
<div class="container">
    <h1>주문 목록 조회(관리자)</h1>
    <div>
        <span><strong>주문상품</strong></span>
        <input type="text" id="searchProductName" placeholder="상품명을 입력하세요"/>
    </div>
    <div>
        <span><strong>주문번호</strong></span>
        <input type="text" id="searchOrderNumber" placeholder="주문 번호를 입력하세요"/>
    </div>
    <div>
        <span><strong>고객명</strong></span>
        <input type="text" id="searchMemberId" placeholder="회원 아이디를 입력하세요"/>
    </div>
    <div>
        <span><strong>주문일시</strong></span>
        <input type="date" id="orderDate"/>
    </div>

    <div>
        <span><strong>주문상태</strong></span>
        <a
                href="javascript:void(0);"
                th:each="status: ${orderStatuses}"
                th:text="${status.getStatus()}"
                th:onclick="updateOrderStatus([[${status}]])"></a>
    </div>
    <div>
        <button onclick="applyFilters()">검색</button>
        <a href="/admin/orders">초기화</a>
    </div>


    <table id="orderTable">
        <thead>
        <tr>
            <th>주문일시</th>
            <th>주문상품</th>
            <th>주문자</th>
            <th>주문상태</th>
            <th>결제금액</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="order: ${orderPage}">
            <td th:text="${#temporals.format(order.getOrderedAt(), 'yyyy/MM/dd HH:mm')}"></td>
            <td>
                <a th:href="@{/admin/orders/{id}(id=${order.getId()})}" th:text="${order.getOrderName()}"></a>
            </td>
            <td th:text="${order.getOrderer()}"></td>
            <td><span class="status-tag status-completed" th:text="${order.getOrderStatus().getStatus()}"></span></td>
            <td th:text="${order.getPaymentAmount()}"></td>
        </tr>
        </tbody>
    </table>

    <div class="pagination">
        <a th:if="${currentPage > 0}" th:href="@{/admin/orders(page = ${currentPage} - 1)}">이전</a>
        <span>현재 페이지: <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span></span>
        <a th:if="${currentPage < totalPages - 1}" th:href="@{/admin/orders(page = ${currentPage} + 1)}">다음</a>
    </div>
</div>

</main>

<th:block th:replace="layout/layout::footerLayout"></th:block>

<script>
    function applyFilters() {
        // 현재 URL 가져오기
        const currentUrl = new URL(window.location.href);

        // URLSearchParams 객체 가져오기
        const params = currentUrl.searchParams;

        // 각 필터의 값 가져오기
        const productName = document.getElementById("searchProductName").value;
        const orderNumber = document.getElementById("searchOrderNumber").value;
        const memberId = document.getElementById("searchMemberId").value;
        const orderDate = document.getElementById("orderDate").value;

        // 입력된 필터 값을 URLSearchParams에 추가 또는 수정
        if (productName) params.set('productName', productName);
        else params.delete('productName');

        if (orderNumber) params.set('orderNumber', orderNumber);
        else params.delete('orderNumber');

        if (memberId) params.set('memberId', memberId);
        else params.delete('memberId');

        if (orderDate) params.set('orderDate', orderDate);
        else params.delete('orderDate');


        // 수정된 URL로 이동
        window.location.href = `${currentUrl.pathname}?${params.toString()}`;
    }

    function updateOrderStatus(status) {
        const currentUrl = new URL(window.location.href);
        const params = currentUrl.searchParams;

        // 'orderStatus' 파라미터를 추가 또는 수정
        params.set('orderStatus', status);

        // 수정된 URL로 이동
        window.location.href = `${currentUrl.pathname}?${params.toString()}`;
    }

    const currentPath = window.location.pathname;
    const sidebarLinks = document.querySelectorAll('.sidebar .group');

    sidebarLinks.forEach(link => {
        const linkPath = link.getAttribute('href');
        if (linkPath === currentPath) {
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });

</script>

</body>
</html>
